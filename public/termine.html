<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Alle Termine</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>


  <h1>Alle gespeicherten Termine</h1>

  <table border="1" cellpadding="8">
    <thead>
      <tr>
        <th>ID</th>
        <th>Titel</th>
        <th>Start</th>
        <th>Ende</th>
        <th>Aktion</th>
      </tr>
    </thead>

    <tbody id="termin-tabelle">
      <!-- Einträge kommen dynamisch -->
    </tbody>
  </table>

  <script>
    async function ladeTermine() {
      const res = await fetch('/api/termine');
      const daten = await res.json();

      const tbody = document.getElementById('termin-tabelle');
      tbody.innerHTML = '';

      daten.forEach(t => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${t.id}</td>
          <td>${t.titel}</td>
          <td>${new Date(t.start_zeitpunkt).toLocaleString()}</td>
          <td>${new Date(t.ende_zeitpunkt).toLocaleString()}</td>
          <td><button onclick="loescheTermin(${t.id})">Löschen</button></td>
        `;

        tbody.appendChild(tr);
      });
    }

    async function loescheTermin(id) {
      if (!confirm(`Termin #${id} wirklich löschen?`)) return;

      const res = await fetch(`/api/termine/${id}`, {
        method: 'DELETE'
      });

      if (res.ok) {
        alert('Termin gelöscht');
        ladeTermine(); // Tabelle aktualisieren
      } else {
        alert('Fehler beim Löschen');
      }
    }

    ladeTermine();
  </script>
</body>
</html>
